<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digibike Royale</title>
<style>
  body,html {
    margin:0; padding:0; overflow:hidden;
    background:black; color:white;
    font-family:Arial, sans-serif;
  }
  canvas { display:block; }
  #menu {
    position:absolute; top:0; left:0; right:0; bottom:0;
    background:black; display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    color:white; font-family:'TronFont', sans-serif;
  }
  #menu h1 {
    font-size:80px; color:cyan; text-shadow:0 0 20px cyan;
    animation:bounce 2s infinite;
    margin-bottom:40px;
  }
  @keyframes bounce {
    0%,100% { transform:translateY(-10px);}
    50% { transform:translateY(10px);}
  }
  .btn {
    background:transparent; border:2px solid cyan;
    color:cyan; padding:12px 24px;
    font-size:22px; margin:10px;
    cursor:pointer; border-radius:12px;
    text-transform:uppercase;
    text-shadow:0 0 10px cyan;
    transition:all 0.3s;
  }
  .btn:hover {
    background:cyan; color:black;
    box-shadow:0 0 20px cyan;
  }
  #hud {
    position:absolute; top:10px; left:10px;
    font-size:20px; font-weight:bold;
    color:white;
  }
  #spectating {
    position:absolute; bottom:20px; left:0; right:0;
    text-align:center; font-size:28px;
    color:yellow; text-shadow:0 0 10px black;
  }
</style>
</head>
<body>
<div id="menu">
  <h1>Digibike Royale</h1>
  <input id="playerName" placeholder="Enter Name" style="padding:10px;font-size:20px;">
  <select id="colorSelect" style="margin:20px;font-size:20px;padding:10px;">
    <option value="cyan">Cyan</option>
    <option value="red">Red</option>
    <option value="green">Green</option>
    <option value="blue">Blue</option>
  </select>
  <button class="btn" onclick="startGame()">Let's Race!</button>
  <button class="btn" onclick="showInstructions()">Instructions</button>
  <div id="instructions" style="display:none; margin-top:20px; max-width:600px; text-align:left;">
    <p><b>Controls:</b></p>
    <ul>
      <li>Move with WASD</li>
      <li>Throw disc with SPACE</li>
      <li>Pause with SHIFT</li>
      <li>Hold M to expand minimap</li>
    </ul>
  </div>
</div>
<canvas id="gameCanvas"></canvas>
<div id="hud"></div>
<div id="spectating"></div>

<script>
// ====== Constants ======
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const GAME_SIZE = 3000;
const PLAYER_SPEED = 4; // base speed
const TRAIL_LIMIT = 200;
const STORM_INTERVAL = 30000;
const STORM_SHRINK_TIME = 5000;

let bikes = [];
let discs = [];
let explosions = [];
let storm = {size: GAME_SIZE, shrinking:false, lastShrink:Date.now()};
let gameRunning = false;
let playerBike;
let botsAlive = 20;
let keys = {};
let camera = {x:0,y:0};
let spectatingText = "";

// ====== Bike Class ======
class Bike {
  constructor(name, color, isPlayer=false) {
    this.name = name;
    this.color = color;
    this.isPlayer = isPlayer;
    this.reset();
  }

  reset() {
    this.x = Math.random() * (GAME_SIZE-200) + 100;
    this.y = Math.random() * (GAME_SIZE-200) + 100;
    this.dir = 'right';
    this.trail = [];
    this.trailColor = this.color;
    this.alive = true;
    this.ammo = 0;
    this.trailGrace = 2; // ignore last 2 trail cells of own trail
  }

  move() {
    if(!this.alive) return;
    let speed = PLAYER_SPEED * 1.1; // 10% faster
    if(this.dir==='up') this.y -= speed;
    if(this.dir==='down') this.y += speed;
    if(this.dir==='left') this.x -= speed;
    if(this.dir==='right') this.x += speed;
    this.trail.push({x:this.x,y:this.y,bike:this});
    if(this.trail.length > TRAIL_LIMIT) this.trail.shift();
  }

  draw() {
    if(!this.alive) return;
    ctx.shadowBlur=12; ctx.shadowColor=this.trailColor;
    ctx.fillStyle=this.trailColor;
    this.trail.forEach(t=>{
      ctx.fillRect(t.x-camera.x-2,t.y-camera.y-2,4,4);
    });
    ctx.shadowBlur=0;
    ctx.fillRect(this.x-camera.x-5,this.y-camera.y-5,10,10);
    ctx.fillStyle='white'; ctx.font='16px Arial';
    ctx.fillText(this.name,this.x-camera.x-ctx.measureText(this.name).width/2,this.y-camera.y-10);
  }
}

// ====== Disc Class ======
class Disc {
  constructor(x,y,dir,owner) {
    this.x=x; this.y=y; this.dir=dir; this.owner=owner; this.speed=8;
  }
  update() {
    if(this.dir==='up') this.y-=this.speed;
    if(this.dir==='down') this.y+=this.speed;
    if(this.dir==='left') this.x-=this.speed;
    if(this.dir==='right') this.x+=this.speed;
  }
  draw() {
    ctx.fillStyle='white';
    ctx.beginPath();
    ctx.arc(this.x-camera.x,this.y-camera.y,6,0,Math.PI*2);
    ctx.fill();
  }
}

// ====== Explosion Effect ======
class Explosion {
  constructor(x,y,color){
    this.x=x; this.y=y; this.color=color;
    this.particles=[];
    for(let i=0;i<30;i++){
      this.particles.push({
        x:this.x,y:this.y,
        vx:(Math.random()-0.5)*6,
        vy:(Math.random()-0.5)*6,
        life:50
      });
    }
  }
  update(){
    this.particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life--;});
    this.particles=this.particles.filter(p=>p.life>0);
  }
  draw(){
    ctx.fillStyle=this.color;
    this.particles.forEach(p=>{
      ctx.globalAlpha=p.life/50;
      ctx.fillRect(p.x-camera.x,p.y-camera.y,4,4);
      ctx.globalAlpha=1;
    });
  }
}

// ====== Game Functions ======
function startGame(){
  document.getElementById("menu").style.display="none";
  bikes=[]; discs=[]; explosions=[];
  let name=document.getElementById("playerName").value||"Player";
  let color=document.getElementById("colorSelect").value;
  playerBike=new Bike(name,color,true);
  bikes.push(playerBike);
  let names=["BitCrusher","NeonClash","Diskette","PingLord","RasterRider","GlowBug","ByteKnight","LagBeast","GridGoblin","CrashBandit","404Rider","BlueScreen","CyborgLlama","FritzBot","Glitcher","Megabyte","Tronald","ZeroCool","CaptainCache","Daemon"];
  for(let i=0;i<20;i++){
    let bot=new Bike(names[i],["red","blue","green","cyan"][Math.floor(Math.random()*4)]);
    bikes.push(bot);
  }
  gameRunning=true;
  requestAnimationFrame(gameLoop);
}

function showInstructions(){
  let inst=document.getElementById("instructions");
  inst.style.display = inst.style.display==="none" ? "block" : "none";
}

function updateGame(){
  bikes.forEach(b=>b.move());
  discs.forEach(d=>d.update());
  discs=discs.filter(d=>d.x>0&&d.x<GAME_SIZE&&d.y>0&&d.y<GAME_SIZE);
  explosions.forEach(e=>e.update());
  explosions=explosions.filter(e=>e.particles.length>0);

  // Trail collision check
  for(let bike of bikes){
    if(!bike.alive) continue;
    for(let other of bikes){
      for(let i=0;i<other.trail.length;i++){
        let t=other.trail[i];
        if(t.bike===bike && i > other.trail.length-bike.trailGrace-1) continue;
        if(Math.abs(bike.x-t.x)<5 && Math.abs(bike.y-t.y)<5){
          bike.alive=false;
          explosions.push(new Explosion(bike.x,bike.y,bike.color));
        }
      }
    }
  }
}

function drawGame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="black"; ctx.fillRect(0,0,canvas.width,canvas.height);
  bikes.forEach(b=>b.draw());
  discs.forEach(d=>d.draw());
  explosions.forEach(e=>e.draw());
  document.getElementById("hud").innerText=`Players: ${bikes.filter(b=>b.alive).length}/21`;
}

// ====== Loop ======
function gameLoop(){
  if(!gameRunning) return;
  updateGame();
  drawGame();
  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
